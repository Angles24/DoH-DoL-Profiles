<?xml version="1.0" encoding="UTF-8"?>
<Profile>
  <Name>Use Master Books</Name>
  <Order>
    <RunCode Name="UseBooks"/>
  </Order>
  <CodeChunks>
    <CodeChunk Name="UseBooks">
      <![CDATA[
        await LlamaLibrary.Helpers.GeneralFunctions.StopBusy();
        await Coroutine.Sleep(2500);

        var heldBooks = InventoryManager.FilledSlots
          .Where(bs => bs.CanUse()
            && (bs?.Item?.BackingAction?.Id == 2136   // Master Books
              || bs?.Item?.BackingAction?.Id == 4107) // Folklore Tomes
        );

        foreach (var book in heldBooks)
        {
          Logging.Write($"Using ({book.RawItemId}) {book.Name}");

          book.UseItem();

          if (await Coroutine.Wait(5000, () => Core.Me.IsCasting))
          {
            await Coroutine.Wait(5000, () => !Core.Me.IsCasting);
            await Coroutine.Sleep(2500);
          }
        }
      ]]>
    </CodeChunk>
  </CodeChunks>
</Profile>
